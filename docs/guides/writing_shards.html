<!DOCTYPE HTML>
<html lang="zn_cn" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>编写 Shards 包 - Crystal 语言参考</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> 介绍</a></li><li class="chapter-item expanded "><a href="../installation/index.html"><strong aria-hidden="true">2.</strong> 安装</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../installation/on_debian_and_ubuntu.html"><strong aria-hidden="true">2.1.</strong> 在 Debian 和 Ubuntu</a></li><li class="chapter-item expanded "><a href="../installation/on_redhat_and_centos.html"><strong aria-hidden="true">2.2.</strong> 在 RedHat 和 CentOS</a></li><li class="chapter-item expanded "><a href="../installation/on_arch_linux.html"><strong aria-hidden="true">2.3.</strong> 在 Arch Linux</a></li><li class="chapter-item expanded "><a href="../installation/on_gentoo_linux.html"><strong aria-hidden="true">2.4.</strong> 在 Gentoo Linux</a></li><li class="chapter-item expanded "><a href="../installation/on_mac_osx_using_homebrew.html"><strong aria-hidden="true">2.5.</strong> 在 Mac OSX 使用 Homebrew</a></li><li class="chapter-item expanded "><a href="../installation/on_linux_using_linuxbrew.html"><strong aria-hidden="true">2.6.</strong> 在 Linux 使用 Linuxbrew</a></li><li class="chapter-item expanded "><a href="../installation/on_bash_on_ubuntu_on_windows.html"><strong aria-hidden="true">2.7.</strong> 在 Windows 的 Ubuntu 子系统使用 Bash</a></li><li class="chapter-item expanded "><a href="../installation/on_native_windows.html"><strong aria-hidden="true">2.8.</strong> 在 Windows 原生环境</a></li><li class="chapter-item expanded "><a href="../installation/from_a_targz.html"><strong aria-hidden="true">2.9.</strong> 从 tar.gz</a></li><li class="chapter-item expanded "><a href="../installation/from_source_repository.html"><strong aria-hidden="true">2.10.</strong> 从源码编译</a></li></ol></li><li class="chapter-item expanded "><a href="../using_the_compiler/index.html"><strong aria-hidden="true">3.</strong> 使用编译器</a></li><li class="chapter-item expanded "><a href="../overview/index.html"><strong aria-hidden="true">4.</strong> 概览和例子</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/hello_world.html"><strong aria-hidden="true">4.1.</strong> Hello World!</a></li><li class="chapter-item expanded "><a href="../overview/http_server.html"><strong aria-hidden="true">4.2.</strong> HTTP Server</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/index.html"><strong aria-hidden="true">5.</strong> 语法和语义</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/comments.html"><strong aria-hidden="true">5.1.</strong> 注释</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals.html"><strong aria-hidden="true">5.2.</strong> 字面量</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/nil.html"><strong aria-hidden="true">5.2.1.</strong> Nil</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/bool.html"><strong aria-hidden="true">5.2.2.</strong> Bool</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/integers.html"><strong aria-hidden="true">5.2.3.</strong> 整数</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/floats.html"><strong aria-hidden="true">5.2.4.</strong> 浮点数</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/char.html"><strong aria-hidden="true">5.2.5.</strong> 字符</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/string.html"><strong aria-hidden="true">5.2.6.</strong> 字符串</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/symbol.html"><strong aria-hidden="true">5.2.7.</strong> 符号</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/array.html"><strong aria-hidden="true">5.2.8.</strong> 数组</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/hash.html"><strong aria-hidden="true">5.2.9.</strong> 散列</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/range.html"><strong aria-hidden="true">5.2.10.</strong> 范围</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/regex.html"><strong aria-hidden="true">5.2.11.</strong> 正则表达式</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/tuple.html"><strong aria-hidden="true">5.2.12.</strong> 元组</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/named_tuple.html"><strong aria-hidden="true">5.2.13.</strong> 命名元组</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/proc.html"><strong aria-hidden="true">5.2.14.</strong> 闭包</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/literals/command.html"><strong aria-hidden="true">5.2.15.</strong> 命令</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/assignment.html"><strong aria-hidden="true">5.3.</strong> 赋值</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/multiple_assignment.html"><strong aria-hidden="true">5.3.1.</strong> 多重赋值</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/local_variables.html"><strong aria-hidden="true">5.4.</strong> 局部变量</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/control_expressions.html"><strong aria-hidden="true">5.5.</strong> 控制结构</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/truthy_and_falsey_values.html"><strong aria-hidden="true">5.5.1.</strong> “真”与“假”值</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/if.html"><strong aria-hidden="true">5.5.2.</strong> if</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/as_a_suffix.html"><strong aria-hidden="true">5.5.2.1.</strong> 作为后缀</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/as_an_expression.html"><strong aria-hidden="true">5.5.2.2.</strong> 作为表达式</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/ternary_if.html"><strong aria-hidden="true">5.5.2.3.</strong> 三元 if 表达式</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/if_var.html"><strong aria-hidden="true">5.5.2.4.</strong> if 变量</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/if_varis_a.html"><strong aria-hidden="true">5.5.2.5.</strong> if var.is_a?(...)</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/if_varresponds_to.html"><strong aria-hidden="true">5.5.2.6.</strong> if var.responds_to?(...)</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/if_var_nil.html"><strong aria-hidden="true">5.5.2.7.</strong> if var.nil?</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/not.html"><strong aria-hidden="true">5.5.2.8.</strong> if !</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/unless.html"><strong aria-hidden="true">5.5.3.</strong> unless</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/case.html"><strong aria-hidden="true">5.5.4.</strong> case</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/while.html"><strong aria-hidden="true">5.5.5.</strong> while</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/break.html"><strong aria-hidden="true">5.5.5.1.</strong> break</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/next.html"><strong aria-hidden="true">5.5.5.2.</strong> next</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/until.html"><strong aria-hidden="true">5.5.6.</strong> until</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/and.html"><strong aria-hidden="true">5.5.7.</strong> &&</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/or.html"><strong aria-hidden="true">5.5.8.</strong> ||</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/requiring_files.html"><strong aria-hidden="true">5.6.</strong> 导入文件</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/types_and_methods.html"><strong aria-hidden="true">5.7.</strong> 类型和方法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/everything_is_an_object.html"><strong aria-hidden="true">5.7.1.</strong> 一切都是对象</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/the_program.html"><strong aria-hidden="true">5.7.2.</strong> Crystal 程序</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/classes_and_methods.html"><strong aria-hidden="true">5.7.3.</strong> 类和方法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/new,_initialize_and_allocate.html"><strong aria-hidden="true">5.7.3.1.</strong> 实例化，初始化和内存分配</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/methods_and_instance_variables.html"><strong aria-hidden="true">5.7.3.2.</strong> 方法和实例变量</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/type_inference.html"><strong aria-hidden="true">5.7.3.3.</strong> 类型推导</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/union_types.html"><strong aria-hidden="true">5.7.3.4.</strong> 联合类型</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/overloading.html"><strong aria-hidden="true">5.7.3.5.</strong> 重载</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/default_and_named_arguments.html"><strong aria-hidden="true">5.7.3.6.</strong> 命名参数和默认值</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/splats_and_tuples.html"><strong aria-hidden="true">5.7.3.7.</strong> 不定数目参数和元组展开</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/type_restrictions.html"><strong aria-hidden="true">5.7.3.8.</strong> 类型限制</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/return_types.html"><strong aria-hidden="true">5.7.3.9.</strong> 返回类型</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/default_values_named_arguments_splats_tuples_and_overloading.html"><strong aria-hidden="true">5.7.3.10.</strong> 方法形参详述</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/operators.html"><strong aria-hidden="true">5.7.3.11.</strong> 运算符</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/visibility.html"><strong aria-hidden="true">5.7.3.12.</strong> 可见性</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/inheritance.html"><strong aria-hidden="true">5.7.3.13.</strong> 继承</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/virtual_and_abstract_types.html"><strong aria-hidden="true">5.7.3.13.1.</strong> 虚类型和抽象类型</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/class_methods.html"><strong aria-hidden="true">5.7.3.14.</strong> 类方法</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/class_variables.html"><strong aria-hidden="true">5.7.3.15.</strong> 类变量</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/finalize.html"><strong aria-hidden="true">5.7.3.16.</strong> finalize</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/modules.html"><strong aria-hidden="true">5.7.4.</strong> 模块</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/generics.html"><strong aria-hidden="true">5.7.5.</strong> 泛型</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/structs.html"><strong aria-hidden="true">5.7.6.</strong> 结构体</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/constants.html"><strong aria-hidden="true">5.7.7.</strong> 常量</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/enum.html"><strong aria-hidden="true">5.7.8.</strong> 枚举</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/blocks_and_procs.html"><strong aria-hidden="true">5.7.9.</strong> 块和闭包</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/capturing_blocks.html"><strong aria-hidden="true">5.7.9.1.</strong> 捕获块</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/proc_literal.html"><strong aria-hidden="true">5.7.9.2.</strong> 闭包字面量</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/block_forwarding.html"><strong aria-hidden="true">5.7.9.3.</strong> 传递块</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/closures.html"><strong aria-hidden="true">5.7.9.4.</strong> 闭包及其环境变量</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/alias.html"><strong aria-hidden="true">5.7.10.</strong> 别名</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/exception_handling.html"><strong aria-hidden="true">5.8.</strong> 异常处理</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/type_grammar.html"><strong aria-hidden="true">5.9.</strong> 类型语法</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/type_reflection.html"><strong aria-hidden="true">5.10.</strong> 类型反射</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/is_a.html"><strong aria-hidden="true">5.10.1.</strong> is_a?</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/nil_question.html"><strong aria-hidden="true">5.10.2.</strong> nil?</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/responds_to.html"><strong aria-hidden="true">5.10.3.</strong> responds_to?</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/as.html"><strong aria-hidden="true">5.10.4.</strong> as</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/as_question.html"><strong aria-hidden="true">5.10.5.</strong> as?</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/typeof.html"><strong aria-hidden="true">5.10.6.</strong> typeof</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/macros.html"><strong aria-hidden="true">5.11.</strong> 宏</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/macros/macro_methods.html"><strong aria-hidden="true">5.11.1.</strong> 宏方法</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/macros/hooks.html"><strong aria-hidden="true">5.11.2.</strong> 钩子</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/macros/fresh_variables.html"><strong aria-hidden="true">5.11.3.</strong> 宏内变量</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/attributes.html"><strong aria-hidden="true">5.12.</strong> 属性</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/low_level_primitives.html"><strong aria-hidden="true">5.13.</strong> 底层原语</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/pointerof.html"><strong aria-hidden="true">5.13.1.</strong> pointerof</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/sizeof.html"><strong aria-hidden="true">5.13.2.</strong> sizeof</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/instance_sizeof.html"><strong aria-hidden="true">5.13.3.</strong> instance_sizeof</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/declare_var.html"><strong aria-hidden="true">5.13.4.</strong> 声明未初始化的变量</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/compile_time_flags.html"><strong aria-hidden="true">5.14.</strong> 编译时标记</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/cross-compilation.html"><strong aria-hidden="true">5.14.1.</strong> 交叉编译</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/index.html"><strong aria-hidden="true">5.15.</strong> C语言绑定</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/lib.html"><strong aria-hidden="true">5.15.1.</strong> lib</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/fun.html"><strong aria-hidden="true">5.15.2.</strong> fun</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/out.html"><strong aria-hidden="true">5.15.2.1.</strong> out</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/to_unsafe.html"><strong aria-hidden="true">5.15.2.2.</strong> to_unsafe</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/struct.html"><strong aria-hidden="true">5.15.3.</strong> struct</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/union.html"><strong aria-hidden="true">5.15.4.</strong> union</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/enum.html"><strong aria-hidden="true">5.15.5.</strong> enum</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/variables.html"><strong aria-hidden="true">5.15.6.</strong> 变量</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/constants.html"><strong aria-hidden="true">5.15.7.</strong> 常量</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/type.html"><strong aria-hidden="true">5.15.8.</strong> 类型</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/alias.html"><strong aria-hidden="true">5.15.9.</strong> 别名</a></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/c_bindings/callbacks.html"><strong aria-hidden="true">5.15.10.</strong> 回调</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax_and_semantics/unsafe.html"><strong aria-hidden="true">5.16.</strong> Unsafe 代码</a></li></ol></li><li class="chapter-item expanded "><a href="../conventions/index.html"><strong aria-hidden="true">6.</strong> 约定</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../conventions/coding_style.html"><strong aria-hidden="true">6.1.</strong> 代码风格</a></li><li class="chapter-item expanded "><a href="../conventions/documenting_code.html"><strong aria-hidden="true">6.2.</strong> 代码注释</a></li></ol></li><li class="chapter-item expanded "><a href="../database/index.html"><strong aria-hidden="true">7.</strong> 数据库</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../database/connection_pool.html"><strong aria-hidden="true">7.1.</strong> 连接池</a></li></ol></li><li class="chapter-item expanded "><a href="../guides/index.html"><strong aria-hidden="true">8.</strong> 导引</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../guides/performance.html"><strong aria-hidden="true">8.1.</strong> 性能</a></li><li class="chapter-item expanded "><a href="../guides/concurrency.html"><strong aria-hidden="true">8.2.</strong> 并发</a></li><li class="chapter-item expanded "><a href="../guides/testing.html"><strong aria-hidden="true">8.3.</strong> 测试</a></li><li class="chapter-item expanded "><a href="../guides/writing_shards.html" class="active"><strong aria-hidden="true">8.4.</strong> 编写 Shards 包</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Crystal 语言参考</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="编写-shard"><a class="header" href="#编写-shard">编写 Shard</a></h1>
<p>这篇文章讲述了如何编写 Crystal Shard。</p>
<h2 id="什么是-shard"><a class="header" href="#什么是-shard"><em>什么是 Shard?</em></a></h2>
<p>简单来说， Shard 是 Crystal 代码包， 用于共享给其他项目使用。</p>
<h2 id="概述"><a class="header" href="#概述">概述</a></h2>
<p>这篇教程中，我们会制作一个叫 <em>palindrome-example</em> 的代码库.</p>
<blockquote>
<p>给不认识它的人：回文(palindrome)是一种从前到后和从后到前读都一样的词。例如： racecar, kayak, madam，“信言不美，美言不信”，“落花闲院春衫薄，薄衫春院闲花落”</p>
</blockquote>
<h3 id="要求"><a class="header" href="#要求">要求</a></h3>
<p>为了按照教程发布一个 Crystal Shard，你需要这些东西：</p>
<ul>
<li>一个可用的 <a href="../using_the_compiler/README.html">Crystal 编译器</a></li>
<li>一个可用的 <a href="https://git-scm.com">Git</a></li>
<li>一个 <a href="https://github.com">GitHub</a> 账户</li>
</ul>
<h3 id="创建项目"><a class="header" href="#创建项目">创建项目</a></h3>
<p>用<a href="../using_the_compiler/README.html">Crystal 编译器</a>的 <code>init lib</code> 命令，以标准目录结构创建Crystal库.</p>
<p>在终端中输入： <code>crystal init lib &lt;YOUR-SHARD-NAME&gt;</code></p>
<p>例如：</p>
<pre><code class="language-bash"> $  crystal init lib palindrome-example
      create  palindrome-example/.gitignore
      create  palindrome-example/.editorconfig
      create  palindrome-example/LICENSE
      create  palindrome-example/README.md
      create  palindrome-example/.travis.yml
      create  palindrome-example/shard.yml
      create  palindrome-example/src/palindrome-example.cr
      create  palindrome-example/src/palindrome-example/version.cr
      create  palindrome-example/spec/spec_helper.cr
      create  palindrome-example/spec/palindrome-example_spec.cr
Initialized empty Git repository in /&lt;YOUR-DIRECTORY&gt;/.../palindrome-example/.git/
</code></pre>
<p>...然后 <code>cd</code> 进这个目录：</p>
<p>如：</p>
<pre><code class="language-bash">cd palindrome-example
</code></pre>
<p>然后用 <code>add</code> &amp; <code>commit</code> 把文件加入进Git档案：</p>
<pre><code class="language-bash"> $  git add -A
 $  git commit -am &quot;First Commit&quot;
[master (root-commit) 77bad84] First Commit
 10 files changed, 102 insertions(+)
 create mode 100644 .editorconfig
 create mode 100644 .gitignore
 create mode 100644 .travis.yml
 create mode 100644 LICENSE
 create mode 100644 README.md
 create mode 100644 shard.yml
 create mode 100644 spec/palindrome-example_spec.cr
 create mode 100644 spec/spec_helper.cr
 create mode 100644 src/palindrome-example.cr
 create mode 100644 src/palindrome-example/version.cr
</code></pre>
<h3 id="编写代码"><a class="header" href="#编写代码">编写代码</a></h3>
<p>怎么写代码取决于你自己，但是你写的成果会决定别人是否愿意用你的库，还有你如何维护它。</p>
<h4 id="测试代码"><a class="header" href="#测试代码">测试代码</a></h4>
<ul>
<li>测试你的代码，全部。这是让所有人确定它是否如期工作的唯一方法，包括你自己。</li>
<li>Crystal有 <a href="https://crystal-lang.org/api/Spec.html">内置的测试库</a>，用它就行了。</li>
</ul>
<h4 id="文档"><a class="header" href="#文档">文档</a></h4>
<ul>
<li>用规范的注释解释你的代码，全部，即使是私有方法。</li>
<li>Crystal有 <a href="../conventions/documenting_code.html">内置的文档生成器</a>，用它就行了。</li>
</ul>
<p>运行 <code>crystal docs</code> 来把你的代码和注释转换为带链接的API文档。你可以用浏览器打开<code>/docs/</code> 目录来查看它。</p>
<p>下面讲述了如何把你编译器产生的文档连接到 GitHub Pages。</p>
<p>只要你的文档写完了，并且可以达到，就把这个文档链接加入到你的README.md，这样用户就知道它们。
(记得对应地更改 <code>&lt;LINK-TO-YOUR-DOCUMENTATION&gt;</code> )</p>
<pre><code class="language-Markdown">[![Docs](https://img.shields.io/badge/docs-available-brightgreen.svg)](&lt;LINK-TO-YOUR-DOCUMENTATION&gt;) 
</code></pre>
<h3 id="写-readme"><a class="header" href="#写-readme">写 README</a></h3>
<p>README 是你项目的脸面，对项目的成败都有重大影响。
<a href="https://github.com/matiassingers/awesome-readme">Awesome README</a> 是这方面的一个优秀例子，并且提供了充分的资源。</p>
<p>最重要的，你的 README 应当解释： </p>
<ol>
<li>你的库是什么</li>
<li>它干什么</li>
<li>怎么用它</li>
</ol>
<p>这些解释都应当有良好的结构，辅以充实的样例。</p>
<p>注意： 一定要把Crystal创建的 README 模板里的 <code>[your-github-name]</code> 改成你自己的 GitHub 用户名。</p>
<h4 id="代码风格"><a class="header" href="#代码风格">代码风格</a></h4>
<ul>
<li>有自己的代码风格是好事，不过遵循 <a href="../conventions/coding_style.html">Crystal 团队指定的核心准则</a>有助于增强代码一致性，可读性，也便于他人阅读和使用。</li>
<li>利用Crystal的 <a href="../conventions/documenting_code.html">内置格式化器</a> 可以自动格式化某个目录中的所有 <code>.cr</code>文件。</li>
</ul>
<p>例如： </p>
<pre><code>crystal tool format
</code></pre>
<p>在命令参数中加 <code>--check</code> 可以检查你的代码是否已被正确格式化，即格式化起是否没有产生任何影响。</p>
<p>例如： </p>
<pre><code>crystal tool format --check
</code></pre>
<p>下面的 Travis CI 会教你如何 below to implement this in your build.</p>
<h3 id="编写-shardyml"><a class="header" href="#编写-shardyml">编写 <code>shard.yml</code></a></h3>
<p>以<a href="https://github.com/crystal-lang/shards/blob/master/SPEC.md#names">spec</a> 为准。</p>
<h4 id="名称"><a class="header" href="#名称">名称</a></h4>
<p>你的 <code>shard.yml</code>的 <code>name</code> 属性应当准确地概括你的库。</p>
<ul>
<li>搜索 <a href="https://crystalshards.xyz/">crystalshards.xyz</a>来检查你的名字是否已经被占用。</li>
</ul>
<p>例如</p>
<pre><code class="language-YAML">name: palindrome-example
</code></pre>
<h4 id="描述"><a class="header" href="#描述">描述</a></h4>
<p><code>shard.yml</code>中的 <code>description</code>域是对你Shard的大致描述。</p>
<p><code>description</code> 是用于找到你的Shard的一行概述。</p>
<p>描述应当：</p>
<ol>
<li>翔实</li>
<li>浅显</li>
</ol>
<h4 id="优化"><a class="header" href="#优化">优化</a></h4>
<p>如果其他人压根找不到你的项目,那就很难用到它。
<a href="https://crystalshards.xyz/">crystalshards.xyz</a> 目前是 Crystal 库的索引，我们将对它作出优化。</p>
<p>人们会询问库的<em>大致</em>功能和<em>准确</em>功能。
比如， Bob 想要一个回文数库，但是 Felipe 想要一个涉及文本的库， Susan 又想要一个拼写检查库。</p>
<p>我们的 <code>name</code>域已经是 Bob想要的 &quot;palindrome&quot;，所以我们就不用重复 <em>palindrome</em> 关键词。另外，我们要满足 Susan搜索的 &quot;spelling&quot;和 Felipe搜索的 &quot;text&quot;。</p>
<pre><code class="language-YAML">description: |
  A textual algorithm to tell if a word is spelled the same way forwards as it is backwards.
</code></pre>
<h3 id="github"><a class="header" href="#github">GitHub</a></h3>
<ul>
<li>
<p>创建一个仓， <code>name</code>和 <code>description</code>都和你的 <code>shard.yml</code>相同。</p>
</li>
<li>
<p>加入所需的代码</p>
</li>
</ul>
<pre><code class="language-bash">$ git add -A &amp;&amp; git commit -am &quot;shard complete&quot;
</code></pre>
<ul>
<li>设置远程仓: (记得对应地修改 <code>&lt;YOUR-GITHUB-USERNAME&gt;</code>和 <code>&lt;YOUR-REPOSITORY-NAME&gt;</code>)</li>
</ul>
<p>注意： 你可以随意把 <code>public</code>替换为 <code>origin</code>，或是其他你喜欢的名字。</p>
<pre><code class="language-bash">$ git remote add public https://github.com/&lt;YOUR-GITHUB-NAME&gt;/&lt;YOUR-REPOSITORY-NAME&gt;.git
</code></pre>
<ul>
<li>Push 上去： </li>
</ul>
<pre><code class="language-bash">$ git push public master
</code></pre>
<h4 id="github-releases"><a class="header" href="#github-releases">GitHub Releases</a></h4>
<p>GitHub Releases 是个好的实践。</p>
<p>在你的README中加入编译提示，来提醒用户 release 的位置：
(记得对应地修改 <code>&lt;YOUR-GITHUB-USERNAME&gt;</code>和 <code>&lt;YOUR-REPOSITORY-NAME&gt;</code>)</p>
<pre><code class="language-Markdown">[![GitHub release](https://img.shields.io/github/release/&lt;YOUR-GITHUB-USERNAME&gt;/&lt;YOUR-REPOSITORY-NAME&gt;.svg)](https://github.com/&lt;YOUR-GITHUB-USERNAME&gt;/&lt;YOUR-REPOSITORY-NAME&gt;/releases)
</code></pre>
<p>一开始线把它设为你的 <em>releases</em> 页面。</p>
<ul>
<li>它们在 <code>https://github.com/&lt;YOUR-GITHUB-NAME&gt;/&lt;YOUR-REPOSITORY-NAME&gt;/releases</code></li>
</ul>
<p>点击 &quot;Create a new release&quot;.</p>
<p>根据 <a href="https://github.com/crystal-lang/shards/blob/master/README.md"> Crystal Shards README</a>, </p>
<blockquote>
<p>当库在 repositories发布时, 这个仓应当有 semver式的版本标签，以 <code>v</code>为前缀。例如： v1.2.3, v2.0.0-rc1 或 v2017.04.1</p>
</blockquote>
<p>相应地，在 <code>tag version</code>输入你的版本, 比如 <code>v0.1.0</code>，这一定要与  <code>shard.yml</code> 中的<code>version</code>匹配。写上 <code>v0.1.0</code>，然后写一小段发布通告。 </p>
<p>点击 &quot;Publish release&quot;，完成。</p>
<p>你现在就会注意到README 里面的 GitHub Release badge已经更新了。</p>
<p>遵循<a href="http://semver.org/">语义版本</a>，每次创建新Realease时都把你的代码推送到 <code>master</code>。</p>
<h3 id="travis-ci-和-travisyml"><a class="header" href="#travis-ci-和-travisyml">Travis CI 和 <code>.travis.yml</code></a></h3>
<p>如果你没有准备好，就先去 <a href="https://travis-ci.org/">注册 Travis CI 账号</a>。</p>
<p>在你README.md 的description 下方加入 build badge:
(记得对应地修改 <code>&lt;YOUR-GITHUB-USERNAME&gt;</code>和 <code>&lt;YOUR-REPOSITORY-NAME&gt;</code>)</p>
<pre><code class="language-Markdown">[![Build Status](https://travis-ci.org/&lt;YOUR-GITHUB-USERNAME&gt;/&lt;YOUR-REPOSITORY-NAME&gt;.svg?branch=master)](https://travis-ci.org/&lt;YOUR-GITHUB-USERNAME&gt;/&lt;YOUR-REPOSITORY-NAME&gt;) 
</code></pre>
<p>Build badges 可以简洁地告诉人们你的代码是否通过了 Travis CI 编译。</p>
<p>把这些加入你的 <code>.travis.yml</code>：</p>
<pre><code class="language-YAML">script:
  - crystal spec
</code></pre>
<p>这会让 Travis CI运行你的测试样例。 
根据命令的结果， Travis CI 会返回一个 <a href="https://docs.travis-ci.com/user/customizing-the-build/#Breaking-the-Build">构建状态</a> ，它是 &quot;passed&quot;, &quot;errored&quot;, &quot;failed&quot; 或 &quot;canceled&quot; 的一种。</p>
<p>如果你希望所有的代码都以 <code>crystal tool format</code>格式化，增加一行 <code>crystal tool format --check</code>。如果代码没有正确格式化，这就会 <a href="https://docs.travis-ci.com/user/for-beginners/#Breaking-the-Build">破坏构建状态</a> ，就像测试失败了一样。</p>
<p>例如</p>
<pre><code class="language-YAML">script:
  - crystal spec
  - crystal tool format --check
</code></pre>
<p>Commit ，然后 push 到 GitHub。</p>
<p>按照<a href="https://docs.travis-ci.com/user/getting-started/">如下指示</a> 建立 repo &amp; 运行 Travis CI。</p>
<p>一旦你运行起来，编译通过，你README中的 build badge就会被更新。</p>
<h4 id="把-docs-绑定到-github-pages"><a class="header" href="#把-docs-绑定到-github-pages">把 <code>docs</code> 绑定到 GitHub-Pages</a></h4>
<p>把这些 <code>script</code> 加入你的 <code>.travis.yml</code>:</p>
<pre><code class="language-YAML">  - crystal docs
</code></pre>
<p>这会让 Travis CI 创建你的文档。</p>
<p>然后，把这些部分加入你的 <code>.travis.yml</code>：
(记得对应地更改 <code>&lt;YOUR-GITHUB-REPOSITORY-NAME&gt;</code>)</p>
<pre><code class="language-YAML">deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  project_name: &lt;YOUR-GITHUB-REPOSITORY-NAME&gt;
  on:
    branch: master
  local_dir: docs
</code></pre>
<p>用你的<a href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">personal access token</a>和 <code>GITHUB_TOKEN</code>来<a href="https://docs.travis-ci.com/user/environment-variables#Defining-Variables-in-Repository-Settings">设置环境变量</a>。</p>
<p>一路下来 <code>.travis.yml</code>应当看着像这样：</p>
<pre><code class="language-YAML">language: crystal
script:
  - crystal spec
  - crystal docs
deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  project_name: &lt;YOUR-GITHUB-REPOSITORY-NAME&gt;
  on:
    branch: master
  local_dir: docs
</code></pre>
<p><a href="https://docs.travis-ci.com/user/deployment/pages/">这里</a> 有用 Travis CI 部署 GitHub-Pages 的官方文档。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guides/testing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guides/testing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
